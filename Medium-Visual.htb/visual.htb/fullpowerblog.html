<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Give Me Back My Privileges! Please?" /><meta property="og:locale" content="en" /><meta name="description" content="I want to tell you the story of a service account which lost all its powers (a.k.a. privileges). Windows world is getting increasingly ruthless and when the system considers you are not worthy, this is what happens. Fortunately for our service account, all is not lost, there’s still hope. In this merciless world, you can always turn to the old sages to find some comfort and support. Among them, the Task Scheduler might be willing to help and restore what was lost, provided that you ask kindly…" /><meta property="og:description" content="I want to tell you the story of a service account which lost all its powers (a.k.a. privileges). Windows world is getting increasingly ruthless and when the system considers you are not worthy, this is what happens. Fortunately for our service account, all is not lost, there’s still hope. In this merciless world, you can always turn to the old sages to find some comfort and support. Among them, the Task Scheduler might be willing to help and restore what was lost, provided that you ask kindly…" /><link rel="canonical" href="https://itm4n.github.io/localservice-privileges/" /><meta property="og:url" content="https://itm4n.github.io/localservice-privileges/" /><meta property="og:site_name" content="itm4n’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-12-05T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Give Me Back My Privileges! Please?" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-12-05T00:00:00+01:00","datePublished":"2019-12-05T00:00:00+01:00","description":"I want to tell you the story of a service account which lost all its powers (a.k.a. privileges). Windows world is getting increasingly ruthless and when the system considers you are not worthy, this is what happens. Fortunately for our service account, all is not lost, there’s still hope. In this merciless world, you can always turn to the old sages to find some comfort and support. Among them, the Task Scheduler might be willing to help and restore what was lost, provided that you ask kindly…","headline":"Give Me Back My Privileges! Please?","mainEntityOfPage":{"@type":"WebPage","@id":"https://itm4n.github.io/localservice-privileges/"},"url":"https://itm4n.github.io/localservice-privileges/"}</script><title>Give Me Back My Privileges! Please? | itm4n's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="itm4n's blog"><meta name="application-name" content="itm4n's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/img/itm4n.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><h1 class="site-title"> <a href="/">itm4n's blog</a>
</h1>
<p class="site-subtitle fst-italic mb-0">Pentesting &amp; Windows security research</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav">
<li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a>
</li>
<li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a>
</li>
<li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a>
</li>
<li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a>
</li>
<li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a>
</li>
</ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/itm4n" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss"> <i class="fas fa-rss"></i> </a> <a href="https://infosec.exchange/@itm4n" aria-label="mastodon" target="_blank" rel="noopener noreferrer me"> <i class="fab fa-mastodon"></i> </a>
</div></aside><div id="main-wrapper" class="d-flex justify-content-center">
<div class="container d-flex flex-column px-xxl-5">
<header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100">
<nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Give Me Back My Privileges! Please?</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div>
<button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
</div></header><div class="row flex-grow-1">
<main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Give Me Back My Privileges! Please?</h1>
<div class="post-meta text-muted"> <span> Posted <time data-ts="1575500400" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom"> Dec 5, 2019 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://infosec.exchange/@itm4n">itm4n</a> </em> </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1508 words"> <em>8 min</em> read</span>
</div>
</div></header><div class="content">
<p>I want to tell you the story of a service account which lost all its powers (a.k.a. privileges). Windows world is getting increasingly ruthless and when the system considers you are not worthy, this is what happens. Fortunately for our service account, all is not lost, there’s still hope. In this merciless world, you can always turn to the old sages to find some comfort and support. Among them, the Task Scheduler might be willing to help and restore what was lost, provided that you ask kindly…</p>
<h2 id="sorry-no-impersonation-privileges-for-you">
<span class="me-2">Sorry. No Impersonation Privileges For You.</span><a href="#sorry-no-impersonation-privileges-for-you" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>
<p>A few weeks ago, Phillip Langlois and Edward Torkington of NCC Group published an interesting write-up about a <a href="https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2019/november/cve-2019-1405-and-cve-2019-1322-elevation-to-system-via-the-upnp-device-host-service-and-the-update-orchestrator-service/">privilege escalation vulnerability in the UPnP Device Host Service</a>. If you’re interested in Windows Privilege Escalation bugs on Windows, you should definitely have a look at it. They explained how they were able to leverage a COM object exposed by this service to get arbitrary code execution in the context of <code class="language-plaintext highlighter-rouge">NT AUTHORITY\LOCAL SERVICE</code>.</p>
<p>Usually, in this situation, you could then elevate your privileges to <code class="language-plaintext highlighter-rouge">NT AUTHORITY\SYSTEM</code> thanks to the impersonation capabilities of this service account. However, in that case, it wasn’t that simple as they outlined in their conclusion.</p>
<blockquote><p><em>On Windows 10, the UPnP Device Host service is configured to execute without impersonation privileges as the user <code class="language-plaintext highlighter-rouge">NT AUTHORITY\LOCAL SERVICE</code> with a ServiceSidType set to <code class="language-plaintext highlighter-rouge">SERVICE_SID_TYPE_UNRESTRICTED</code>. […] Unfortunately, this prevents elevation to <code class="language-plaintext highlighter-rouge">NT AUTHORITY\SYSTEM</code> via well-known methods […].</em></p></blockquote>
<p>If you check the properties of the service, you’ll see that it’s executed with the <code class="language-plaintext highlighter-rouge">-k LocalServiceAndNoImpersonation</code> option.</p>
<p><a href="/assets/posts/2019-12-05-localservice-privileges/01_upnphost-properties.png" class="popup img-link shimmer"><img src="/assets/posts/2019-12-05-localservice-privileges/01_upnphost-properties.png" alt="" loading="lazy"></a></p>
<p>And if you check the token associated to the process, you’ll see that it has only two privileges indeed.</p>
<p><a href="/assets/posts/2019-12-05-localservice-privileges/02_upnphost-token.png" class="popup img-link shimmer"><img src="/assets/posts/2019-12-05-localservice-privileges/02_upnphost-token.png" alt="" loading="lazy"></a></p>
<p>Other services, such as Bluetooth Support for example, run with the <code class="language-plaintext highlighter-rouge">-k LocalService</code> option.</p>
<p><a href="/assets/posts/2019-12-05-localservice-privileges/03_bthserv-properties.png" class="popup img-link shimmer"><img src="/assets/posts/2019-12-05-localservice-privileges/03_bthserv-properties.png" alt="" loading="lazy"></a></p>
<p>In this case, we can see that the privileges of the <code class="language-plaintext highlighter-rouge">NT AUTHORITY\LOCAL SERVICE</code> account are maintained.</p>
<p><a href="/assets/posts/2019-12-05-localservice-privileges/04_bthserv-token.png" class="popup img-link shimmer"><img src="/assets/posts/2019-12-05-localservice-privileges/04_bthserv-token.png" alt="" loading="lazy"></a></p>
<p><strong>Note:</strong> as a reminder, it might be a bit confusing but the <code class="language-plaintext highlighter-rouge">Enabled</code>/<code class="language-plaintext highlighter-rouge">Disabled</code> status of a privilege doesn’t matter. What matters is that it is present within the token. If so, you can enable/disable them at runtime whenever you want.</p>
<p>All that being said, in the case of a service such as the UPNP Device Host Service, is there a way to get all these privileges back? The answer is “yes” (otherwise there would be no point in writing this article <img class="emoji" title=":grin:" alt=":grin:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f601.png" height="20" width="20">). What is more surprising though is that it is quite simple to achieve.</p>
<h2 id="reproducing-the-conditions-of-the-exploit">
<span class="me-2">Reproducing the conditions of the exploit</span><a href="#reproducing-the-conditions-of-the-exploit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>
<p>In order to reproduce the conditions of the UPnP Device Host Service vulnerability, I’ll use NirSoft’s <a href="https://www.nirsoft.net/utils/run_from_process.html"><code class="language-plaintext highlighter-rouge">RunFromProcess</code></a> tool to open a bindshell as a subprocess of the service. This requires admin privileges of course. For the bindshell, I’ll use <a href="https://github.com/besimorhino/powercat"><code class="language-plaintext highlighter-rouge">powercat</code></a>. As its name implies, it’s a PowerShell implementation of <code class="language-plaintext highlighter-rouge">netcat</code> and it’s definitely one to have in your toolbox if you’re a pentester.</p>
<p><code class="language-plaintext highlighter-rouge">RunFromProcess</code> usage is pretty simple. The first argument is the name or the PID of the process you want to run your executable from. The second argument is the absolute path of the executable. Then you can append a list of arguments for your executable.</p>
<div class="language-batch highlighter-rouge">
<div class="code-header"> <span data-label-text="Batch"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="kd">RunFromProcess</span><span class="na">-x</span><span class="m">64</span>.exe <span class="m">3636</span> <span class="s2">"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"</span> <span class="na">-ep </span><span class="kd">Bypass</span> <span class="na">-Command </span><span class="s2">". C:\TOOLS\powercat.ps1;powercat -l -p 7001 -ep"</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>Be careful, it won’t tell you whether it succeeded or not so you should check your command twice before running it. Once it’s done, we can use <code class="language-plaintext highlighter-rouge">powercat</code> in “client mode” to connect to the bindshell.</p>
<div class="language-powershell highlighter-rouge">
<div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="o">.</span><span class="w"> </span><span class="o">.</span><span class="n">\powercat.ps1</span><span class="w">
</span><span class="nx">powercat</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="nx">127.0.0.1</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">7001</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>
<p><a href="/assets/posts/2019-12-05-localservice-privileges/05_localservice-bindshell.png" class="popup img-link shimmer"><img src="/assets/posts/2019-12-05-localservice-privileges/05_localservice-bindshell.png" alt="" loading="lazy"></a></p>
<p>Nice! <img class="emoji" title=":thumbsup:" alt=":thumbsup:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f44d.png" height="20" width="20"> We have a shell in the context of <code class="language-plaintext highlighter-rouge">NT AUTHORITY\LOCAL SERVICE</code> and as you can see we have only two privileges. We can therefore start working from this prompt.</p>
<h2 id="the-task-scheduler-has-got-your-back">
<span class="me-2">The Task Scheduler Has Got Your Back!</span><a href="#the-task-scheduler-has-got-your-back" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>
<p>Any user can create its own scheduled tasks in Windows and <code class="language-plaintext highlighter-rouge">NT AUTHORITY\LOCAL SERVICE</code> is no exception to this rule. By default, the account used to run a Task is the same as the Task’s “author”. The scheduled task creation process is done through a series of local (or remote) RPC calls but I won’t go into detail about this.</p>
<p>Let’s see what happens when we create a task in the context of a <code class="language-plaintext highlighter-rouge">LOCAL SERVICE</code> account. This can be achieved in three simple steps using PowerShell.</p>
<p>First, we need to create an <code class="language-plaintext highlighter-rouge">Action</code> object for the task. That’s where you specify the program/script to execute along with some optional arguments. Here, we want to open a bindshell on port 7002 so we will use the following command.</p>
<div class="language-powershell highlighter-rouge">
<div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nv">$TaskAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-ScheduledTaskAction</span><span class="w"> </span><span class="nt">-Execute</span><span class="w"> </span><span class="s2">"powershell.exe"</span><span class="w"> </span><span class="nt">-Argument</span><span class="w"> </span><span class="s2">"-Exec Bypass -Command </span><span class="se">`"</span><span class="s2">. C:\TOOLS\powercat.ps1; powercat -l -p 7002 -ep</span><span class="se">`"</span><span class="s2">"</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>
<p>Then, you can “register” the task and start it manually.</p>
<div class="language-powershell highlighter-rouge">
<div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="n">Register-ScheduledTask</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nv">$TaskAction</span><span class="w"> </span><span class="nt">-TaskName</span><span class="w"> </span><span class="s2">"SomeTask"</span><span class="w">
</span><span class="n">Start-ScheduledTask</span><span class="w"> </span><span class="nt">-TaskName</span><span class="w"> </span><span class="s2">"SomeTask"</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>
<p><a href="/assets/posts/2019-12-05-localservice-privileges/06_localservice-create-task.png" class="popup img-link shimmer"><img src="/assets/posts/2019-12-05-localservice-privileges/06_localservice-create-task.png" alt="" loading="lazy"></a></p>
<p>Let’s use <code class="language-plaintext highlighter-rouge">powercat</code> once again in client mode to connect to the new bindshell and…</p>
<div class="language-powershell highlighter-rouge">
<div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="o">.</span><span class="w"> </span><span class="o">.</span><span class="n">\powercat.ps1</span><span class="w">
</span><span class="nx">powercat</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="nx">127.0.0.1</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">7002</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>
<p><a href="/assets/posts/2019-12-05-localservice-privileges/07_localservice-bindshell-privs.png" class="popup img-link shimmer"><img src="/assets/posts/2019-12-05-localservice-privileges/07_localservice-bindshell-privs.png" alt="" loading="lazy"></a></p>
<p>…we have all our privileges back!!! <img class="emoji" title=":astonished:" alt=":astonished:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f632.png" height="20" width="20"></p>
<p><strong>Wait a minute…</strong> Do we really have <strong>ALL</strong> of them back?! <img class="emoji" title=":eyes:" alt=":eyes:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f440.png" height="20" width="20"></p>
<p>According to <a href="https://docs.microsoft.com/en-us/windows/win32/services/localservice-account">Microsoft documentation</a>, the local service account has the following privileges by default:</p>
<ul>
<li>
<code class="language-plaintext highlighter-rouge">SE_ASSIGNPRIMARYTOKEN_NAME</code> (disabled)</li>
<li>
<code class="language-plaintext highlighter-rouge">SE_AUDIT_NAME</code> (disabled)</li>
<li>
<code class="language-plaintext highlighter-rouge">SE_CHANGE_NOTIFY_NAME</code> (enabled)</li>
<li>
<code class="language-plaintext highlighter-rouge">SE_CREATE_GLOBAL_NAME</code> (enabled)</li>
<li>
<code class="language-plaintext highlighter-rouge">SE_IMPERSONATE_NAME</code> (enabled)</li>
<li>
<code class="language-plaintext highlighter-rouge">SE_INCREASE_QUOTA_NAME</code> (disabled)</li>
<li>
<code class="language-plaintext highlighter-rouge">SE_SHUTDOWN_NAME</code> (disabled)</li>
<li>
<code class="language-plaintext highlighter-rouge">SE_UNDOCK_NAME</code> (disabled)</li>
<li>Any privileges assigned to users and authenticated users</li>
</ul>
<p>All of them are present, at the exception of <code class="language-plaintext highlighter-rouge">SE_IMPERSONATE_NAME</code>. What’s going on?!</p>
<h2 id="going-the-extra-mile">
<span class="me-2">Going The Extra Mile</span><a href="#going-the-extra-mile" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>
<p>At this point, we have the <code class="language-plaintext highlighter-rouge">SE_ASSIGNPRIMARYTOKEN_NAME</code> and <code class="language-plaintext highlighter-rouge">SE_INCREASE_QUOTA_NAME</code> privileges. That’s enough for impersonating any user so we could consider it’s “game over”. However, the fact that <code class="language-plaintext highlighter-rouge">SE_IMPERSONATE_NAME</code> was missing was bugging me.</p>
<p>Therefore, I spent more time browsing Microsoft documentation in the hope of finding an explanation and I found it. It turns out that there is a small chapter dedicated to <a href="https://docs.microsoft.com/en-us/windows/win32/taskschd/task-security-hardening">Task Security Hardening</a>. At the very end of this chapter you can read the following.</p>
<blockquote><p><em>If <code class="language-plaintext highlighter-rouge">RequiredPrivileges</code> is not present in the task definition, the default privileges of task principal account without the <code class="language-plaintext highlighter-rouge">SeImpersonatePrivilege</code> will be used for task process. If <code class="language-plaintext highlighter-rouge">ProcessTokenSidType</code> is not present in the task definition, “unrestricted” is used as the default.</em></p></blockquote>
<p>In a single phrase, we have multiple answers.</p>
<ul>
<li><p>A task process is created with the <strong>default privileges of the task principal account</strong>.</p></li>
<li><p>If <code class="language-plaintext highlighter-rouge">RequiredPrivileges</code> is not present, the default privilege set associated to the account is used <strong>without <code class="language-plaintext highlighter-rouge">SeImpersonatePrivilege</code></strong>.</p></li>
</ul>
<p>This explains why we were able to get our privileges back - except <code class="language-plaintext highlighter-rouge">SeImpersonatePrivilege</code> - simply by creating a scheduled task. However, it leads to another question: what is this <code class="language-plaintext highlighter-rouge">RequiredPrivileges</code> thing and can we do somehing about it?</p>
<p>If you take a look at the documentation of the <code class="language-plaintext highlighter-rouge">Register-ScheduledTask</code> PowerShell command, you’ll see that it accepts a <code class="language-plaintext highlighter-rouge">Principal</code> as an optional argument. You can use this <code class="language-plaintext highlighter-rouge">Principal</code> to <em>run a task under the security context of a specified account</em>.</p>
<p>This <code class="language-plaintext highlighter-rouge">Principal</code> can be created using the <code class="language-plaintext highlighter-rouge">New-ScheduledTaskPrincipal</code> command, which accepts the following arguments.</p>
<pre><code class="language-txt">New-ScheduledTaskPrincipal
   [[-Id] &lt;String&gt;]
   [[-RunLevel] &lt;RunLevelEnum&gt;]
   [[-ProcessTokenSidType] &lt;ProcessTokenSidTypeEnum&gt;]
   [[-RequiredPrivilege] &lt;String[]&gt;]
   [-UserId] &lt;String&gt;
   [[-LogonType] &lt;LogonTypeEnum&gt;]
   [-CimSession &lt;CimSession[]&gt;]
   [-ThrottleLimit &lt;Int32&gt;]
   [-AsJob]
   [&lt;CommonParameters&gt;]
</code></pre>
<p>Here is the <code class="language-plaintext highlighter-rouge">RequiredPrivilege</code> option that was mentioned in the Task Security Hardening article. This parameter <strong><em>specifies an array of user rights that Task Scheduler uses to run the tasks that are associated with the principal</em></strong>.</p>
<p><strong>Note:</strong> you can find a complete list of Privilege constants <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/privilege-constants">here</a>.</p>
<p>We have all the information we need. Let’s do this!</p>
<p>First, we create a String array containing all the privileges we want. Then, we pass it as a parameter to the <code class="language-plaintext highlighter-rouge">New-ScheduledTaskPrincipal</code> command to create the <code class="language-plaintext highlighter-rouge">Principal</code> object for our new scheduled task.</p>
<div class="language-powershell highlighter-rouge">
<div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="c"># Create a list of privileges </span><span class="w">
</span><span class="p">[</span><span class="n">System.String</span><span class="p">[]]</span><span class="nv">$Privs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SeAssignPrimaryTokenPrivilege"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SeAuditPrivilege"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SeChangeNotifyPrivilege"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SeCreateGlobalPrivilege"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SeImpersonatePrivilege"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SeIncreaseQuotaPrivilege"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SeShutdownPrivilege"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SeUndockPrivilege"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SeIncreaseWorkingSetPrivilege"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SeTimeZonePrivilege"</span><span class="w">
</span><span class="c"># Create a Principal for the task </span><span class="w">
</span><span class="nv">$TaskPrincipal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-ScheduledTaskPrincipal</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="s2">"LOCALSERVICE"</span><span class="w"> </span><span class="nt">-LogonType</span><span class="w"> </span><span class="nx">ServiceAccount</span><span class="w"> </span><span class="nt">-RequiredPrivilege</span><span class="w"> </span><span class="nv">$Privs</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>
<p>Then, we can use the same commands as before and specify our <code class="language-plaintext highlighter-rouge">Principal</code> object using the appropriate parameter.</p>
<div class="language-powershell highlighter-rouge">
<div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="c"># Create an action for the task </span><span class="w">
</span><span class="nv">$TaskAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-ScheduledTaskAction</span><span class="w"> </span><span class="nt">-Execute</span><span class="w"> </span><span class="s2">"powershell.exe"</span><span class="w"> </span><span class="nt">-Argument</span><span class="w"> </span><span class="s2">"-Exec Bypass -Command </span><span class="se">`"</span><span class="s2">. C:\TOOLS\powercat.ps1; powercat -l -p 7003 -ep</span><span class="se">`"</span><span class="s2">"</span><span class="w">
</span><span class="c"># Create the task</span><span class="w">
</span><span class="n">Register-ScheduledTask</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nv">$TaskAction</span><span class="w"> </span><span class="nt">-TaskName</span><span class="w"> </span><span class="s2">"SomeTask2"</span><span class="w"> </span><span class="nt">-Principal</span><span class="w"> </span><span class="nv">$TaskPrincipal</span><span class="w">
</span><span class="c"># Start the task</span><span class="w">
</span><span class="n">Start-ScheduledTask</span><span class="w"> </span><span class="nt">-TaskName</span><span class="w"> </span><span class="s2">"SomeTask2"</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></div>
</div>
<p><a href="/assets/posts/2019-12-05-localservice-privileges/08_localservice-create-task2.png" class="popup img-link shimmer"><img src="/assets/posts/2019-12-05-localservice-privileges/08_localservice-create-task2.png" alt="" loading="lazy"></a></p>
<p>Nice! <img class="emoji" title=":sunglasses:" alt=":sunglasses:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f60e.png" height="20" width="20"> At least, no error/exception is triggered. Let’s see if it worked by trying to connect to the new bindshell.</p>
<p><a href="/assets/posts/2019-12-05-localservice-privileges/09_localservice-fullprivs.png" class="popup img-link shimmer"><img src="/assets/posts/2019-12-05-localservice-privileges/09_localservice-fullprivs.png" alt="" loading="lazy"></a></p>
<p>It worked! And we have the <code class="language-plaintext highlighter-rouge">SeImpersonatePrivilege</code> privilege back! \o/</p>
<p>As a conclusion, I just want to say that Windows is a very complex Operating System and Microsoft has made huge efforts to harden its security over the years while still maintaining compatibility with legacy stuff. And, this turns out to be a very difficult and thankless job, especially when this same legacy stuff is also what cripples new security models.</p>
<h2 id="links--resources">
<span class="me-2">Links &amp; Resources</span><a href="#links--resources" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>
<ul>
<li><p>FullPowers - Recover the default privilege set of a LOCAL/NETWORK SERVICE account<br> <a href="https://github.com/itm4n/FullPowers">https://github.com/itm4n/FullPowers</a></p></li>
<li><p>CVE-2019-1405 and CVE-2019-1322 – Elevation to SYSTEM via the UPnP Device Host Service and the Update Orchestrator Service<br> <a href="https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2019/november/cve-2019-1405-and-cve-2019-1322-elevation-to-system-via-the-upnp-device-host-service-and-the-update-orchestrator-service/">https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2019/november/cve-2019-1405-and-cve-2019-1322-elevation-to-system-via-the-upnp-device-host-service-and-the-update-orchestrator-service/</a></p></li>
<li><p>Enabling and Disabling Privileges in C++<br> <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/enabling-and-disabling-privileges-in-c--">https://docs.microsoft.com/en-us/windows/win32/secauthz/enabling-and-disabling-privileges-in-c–</a></p></li>
<li><p>NirSoft - RunFromProcess Tool<br> <a href="https://www.nirsoft.net/utils/run_from_process.html">https://www.nirsoft.net/utils/run_from_process.html</a></p></li>
<li><p>powercat<br> <a href="https://github.com/besimorhino/powercat">https://github.com/besimorhino/powercat</a></p></li>
<li><p>MSDN - LocalService Account<br> <a href="https://docs.microsoft.com/en-us/windows/win32/services/localservice-account">https://docs.microsoft.com/en-us/windows/win32/services/localservice-account</a></p></li>
<li><p>MSDN - Task Security Hardening<br> <a href="https://docs.microsoft.com/en-us/windows/win32/taskschd/task-security-hardening">https://docs.microsoft.com/en-us/windows/win32/taskschd/task-security-hardening</a></p></li>
<li><p>MSDN - PowerShell - Register-ScheduledTask<br> <a href="https://docs.microsoft.com/en-us/powershell/module/scheduledtasks/register-scheduledtask?view=win10-ps">https://docs.microsoft.com/en-us/powershell/module/scheduledtasks/register-scheduledtask?view=win10-ps</a></p></li>
<li><p>MSDN - PowerShell - New-ScheduledTaskPrincipal<br> <a href="https://docs.microsoft.com/en-us/powershell/module/scheduledtasks/new-scheduledtaskprincipal?view=win10-ps">https://docs.microsoft.com/en-us/powershell/module/scheduledtasks/new-scheduledtaskprincipal?view=win10-ps</a></p></li>
<li><p>MSDN - Privilege Constants<br> <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/privilege-constants">https://docs.microsoft.com/en-us/windows/win32/secauthz/privilege-constants</a></p></li>
</ul>
</div>
<div class="post-tail-wrapper text-muted">
<div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/windows/">Windows</a>
</div>
<div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/research/" class="post-tag no-text-decoration">Research</a> <a href="/tags/privilege-escalation/" class="post-tag no-text-decoration">Privilege Escalation</a> <a href="/tags/exploit/" class="post-tag no-text-decoration">Exploit</a>
</div>
<div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 ">
<div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div>
<div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://infosec.exchange/share?text=Give%20Me%20Back%20My%20Privileges!%20Please?%20-%20itm4n's%20blog&amp;url=https%3A%2F%2Fitm4n.github.io%2Flocalservice-privileges%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Mastodon" target="_blank" rel="noopener" aria-label="Mastodon"> <i class="fa-fw fab fa-mastodon"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fitm4n.github.io%2Flocalservice-privileges%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="LinkedIn" target="_blank" rel="noopener" aria-label="LinkedIn"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> <i class="fa-fw fas fa-link pe-none"></i> </button> </span>
</div>
</div>
</div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access">
<section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2>
<ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
<li class="text-truncate lh-lg"> <a href="/tpm-based-bitlocker/">A Deep Dive into TPM-based BitLocker Drive Encryption</a>
</li>
<li class="text-truncate lh-lg"> <a href="/usodllloader-part2/">Weaponizing Privileged File Writes with the USO Service - Part 2/2</a>
</li>
<li class="text-truncate lh-lg"> <a href="/credential-guard-bypass/">Revisiting a Credential Guard Bypass</a>
</li>
<li class="text-truncate lh-lg"> <a href="/dll-proxying/">Windows Privilege Escalation - DLL Proxying</a>
</li>
<li class="text-truncate lh-lg"> <a href="/vba-runpe-part1/">VBA RunPE - Breaking Out of Highly Constrained Desktop Environments - Part 1/2</a>
</li>
</ul></section><section><h2 class="panel-heading">Trending Tags</h2>
<div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/research/">Research</a> <a class="post-tag btn btn-outline-primary" href="/tags/exploit/">Exploit</a> <a class="post-tag btn btn-outline-primary" href="/tags/privilege-escalation/">Privilege Escalation</a> <a class="post-tag btn btn-outline-primary" href="/tags/vulnerability/">Vulnerability</a> <a class="post-tag btn btn-outline-primary" href="/tags/bypass/">Bypass</a> <a class="post-tag btn btn-outline-primary" href="/tags/patch-analysis/">Patch Analysis</a> <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
</div></section>
</div>
<section id="toc-wrapper" class="ps-0 pe-4"><h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2>
<nav id="toc"></nav></section></aside>
</div>
<div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
<aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3>
<nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/bmc-patrol-mcmnm-privesc/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1528236000" data-df="ll"> Jun 6, 2018 </time><h4 class="pt-0 my-2">CVE-2017-13130 - BMC Patrol 'mcmnm' - Privilege Escalation via a Vulnerable SUID Binary</h4>
<div class="text-muted"><p> A vulnerability was discovered in the mcmnm binary. It is compiled with a RPATH starting with .:. Therefore, any user can craft a malicious library (e.g.: libmcmclnx.so) and then run mcmnm from the...</p></div>
</div></a></article><article class="col"> <a href="/ca-dollaru-uxdqmsrv-privesc/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1535925600" data-df="ll"> Sep 3, 2018 </time><h4 class="pt-0 my-2">CVE-2019-19544 - CA Dollar Universe 5.3.3 'uxdqmsrv' - Privilege Escalation via a Vulnerable SUID Binary</h4>
<div class="text-muted"><p> A vulnerability was discovered in the uxdqmsrv binary. It consists in an arbitrary file write as root that can be leveraged by any local user to gain full root privileges on the host (UNIX/Linux on...</p></div>
</div></a></article><article class="col"> <a href="/usodllloader-part1/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1565992800" data-df="ll"> Aug 17, 2019 </time><h4 class="pt-0 my-2">Weaponizing Privileged File Writes with the USO Service - Part 1/2</h4>
<div class="text-muted"><p> The DiagHub DLL loading technique found by James Forshaw (a.k.a. @tiraniddo) has become very famous. Whenever you found an arbitrary file write as SYSTEM in Windows or in some third-party software,...</p></div>
</div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/usodllloader-part2/" class="btn btn-outline-primary" aria-label="Older"><p>Weaponizing Privileged File Writes with the USO Service - Part 2/2</p></a> <a href="/cdpsvc-dll-hijacking/" class="btn btn-outline-primary" aria-label="Newer"><p>CDPSvc DLL Hijacking - From LOCAL SERVICE to SYSTEM</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 "><p> © <time>2023</time> <a href="https://infosec.exchange/@itm4n">itm4n</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p>
<p>Using the <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a></p></footer>
</div></div>
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 content">
<div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2>
<div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/research/">Research</a> <a class="post-tag btn btn-outline-primary" href="/tags/exploit/">Exploit</a> <a class="post-tag btn btn-outline-primary" href="/tags/privilege-escalation/">Privilege Escalation</a> <a class="post-tag btn btn-outline-primary" href="/tags/vulnerability/">Vulnerability</a> <a class="post-tag btn btn-outline-primary" href="/tags/bypass/">Bypass</a> <a class="post-tag btn btn-outline-primary" href="/tags/patch-analysis/">Patch Analysis</a> <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
</div></section></div>
<div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
</div></div>
</div>
<aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside>
</div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false"><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close"></button>
</div>
<div class="toast-body text-center pt-0">
<p class="px-2 mb-3">A new version of content is available.</p>
<button type="button" class="btn btn-primary" aria-label="Update"> Update </button>
</div></aside><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.21.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
